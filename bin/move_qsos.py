# SY 5/2/19
# Use alphas generated by CAMB to move qsos in qso catalogue. Seed = 1 which will give us the same input as kappa_input1 files.

import numpy as np
import healpy as hp
from astropy.table import Table, join
from kappa_lya import *

t = Table.read('zcat_desi_drq.fits')

nside=1024
npix=nside**2*12
seed=int(1)
np.random.seed(seed)

#-- Create angular power spectrum of kappa/alphas
theory = Theory()
ell, cell = theory.get_cl_kappa(2.1, kmax=100., nz=100, lmax=10000)
kappa = create_gaussian_kappa(ell, cell, nside=nside, seed=seed)

# Amend DEC and RA for each qso by the bend angles (alphas)
theta_lens, phi_lens = kappa.displace_objects(np.pi/2-np.radians(t['DEC']), np.radians(t['RA']))

t.rename_column('DEC', 'DEC0')
t.rename_column('RA', 'RA0')

t['DEC'] = np.degrees(np.pi/2-theta_lens)
t['RA'] = np.degrees(phi_lens)

t.write('zcat_desi_drq_lensed.fits', format='fits')


